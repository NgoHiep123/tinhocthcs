<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ” ÄÄƒng nháº­p | Tin há»c THCS</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{
      font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-attachment: fixed;
      position: relative;
    }
    body::before {
      content: 'ğŸ’» ğŸ¤– âš¡ ğŸš€ ğŸ’¾ ğŸ®';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      font-size: 32px;
      opacity: 0.05;
      pointer-events: none;
      animation: float 40s infinite linear;
      word-spacing: 150px;
      line-height: 100px;
    }
    @keyframes float {
      0% { transform: translateY(0) rotate(0deg); }
      100% { transform: translateY(-100vh) rotate(360deg); }
    }
    .note{font-size:12px;color:#94a3b8}
    .login-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      animation: slideUp 0.6s ease-out;
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .input-field {
      transition: all 0.3s ease;
    }
    .input-field:focus {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
    }
    .login-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: all 0.3s ease;
    }
    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
    }
  </style>
</head>
<body class="text-slate-100 min-h-screen flex items-center justify-center p-4">
  <div class="login-card w-full max-w-md rounded-3xl p-8 shadow-2xl relative z-10">
    <!-- Icon header -->
    <div class="text-center mb-6">
      <div class="inline-block p-4 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl shadow-xl mb-3">
        <span class="text-5xl">ğŸ”</span>
      </div>
      <h1 class="text-3xl font-black text-gray-900 mb-2">ÄÄƒng nháº­p</h1>
      <p class="text-gray-600">ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i há»‡ thá»‘ng Tin há»c THCS!</p>
    </div>

    <div class="space-y-4">
      <div>
        <label class="block mb-2 text-sm font-bold text-gray-700">ğŸ“ Chá»n khá»‘i</label>
        <select id="grade" class="input-field w-full rounded-xl bg-white border-2 border-gray-200 focus:border-purple-500 px-4 py-3 text-gray-900 font-semibold outline-none"></select>
      </div>
      <div>
        <label class="block mb-2 text-sm font-bold text-gray-700">ğŸ« Chá»n lá»›p</label>
        <select id="class" class="input-field w-full rounded-xl bg-white border-2 border-gray-200 focus:border-purple-500 px-4 py-3 text-gray-900 font-semibold outline-none" disabled></select>
      </div>
      <div>
        <label class="block mb-2 text-sm font-bold text-gray-700">ğŸ‘¤ Há» vÃ  tÃªn</label>
        <select id="student" class="input-field w-full rounded-xl bg-white border-2 border-gray-200 focus:border-purple-500 px-4 py-3 text-gray-900 font-semibold outline-none" disabled></select>
      </div>
      <div>
        <label class="block mb-2 text-sm font-bold text-gray-700">ğŸ”‘ Máº­t kháº©u</label>
        <input id="password" type="password" class="input-field w-full rounded-xl bg-white border-2 border-gray-200 focus:border-purple-500 px-4 py-3 text-gray-900 font-semibold outline-none" placeholder="Nháº­p máº­t kháº©u cá»§a báº¡n">
        <p class="note mt-2 text-gray-500">ğŸ’¡ Náº¿u quÃªn máº­t kháº©u, liÃªn há»‡ giÃ¡o viÃªn Ä‘á»ƒ Ä‘Æ°á»£c cáº¥p láº¡i.</p>
      </div>
      <div class="flex items-center justify-between mt-6 pt-4 border-t border-gray-200">
        <a href="index.html" class="text-sm text-purple-600 hover:text-purple-800 font-semibold transition-colors">â¬… Vá» trang chá»§</a>
        <button id="loginBtn" class="login-btn px-6 py-3 rounded-xl text-white font-black shadow-lg">
          â–¶ï¸ VÃ o lÃ m bÃ i
        </button>
      </div>
      <p id="status" class="text-sm text-red-500 text-center font-semibold min-h-[24px] mt-3"></p>
    </div>
  </div>

<script>
const statusEl = document.getElementById('status');
let DATA = null;

async function loadData(){
  try{
    // Láº¥y Ä‘Æ°á»ng dáº«n tÆ°Æ¡ng Ä‘á»‘i dá»±a trÃªn location hiá»‡n táº¡i
    const basePath = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);
    const jsonPath = basePath + 'students.json?v=' + Date.now();
    
    console.log('Loading students.json from:', jsonPath);
    
    const res = await fetch(jsonPath);
    
    if (!res.ok) {
      throw new Error(`HTTP ${res.status}: ${res.statusText}`);
    }
    
    DATA = await res.json();
    
    if (!DATA || typeof DATA !== 'object') {
      throw new Error('File students.json khÃ´ng Ä‘Ãºng Ä‘á»‹nh dáº¡ng');
    }
    
    const gradeSelect = document.getElementById('grade');
    const grades = Object.keys(DATA).sort((a,b)=>parseInt(a)-parseInt(b));
    
    if (grades.length === 0) {
      throw new Error('KhÃ´ng cÃ³ dá»¯ liá»‡u há»c sinh trong file');
    }
    
    gradeSelect.innerHTML = '<option value="">-- Chá»n khá»‘i --</option>' + grades.map(g=>`<option value="${g}">Khá»‘i ${g}</option>`).join('');
    
    console.log('Loaded', grades.length, 'grades successfully');
    
  }catch(e){
    const errorMsg = `âŒ KhÃ´ng táº£i Ä‘Æ°á»£c danh sÃ¡ch há»c sinh: ${e.message}`;
    statusEl.textContent = errorMsg;
    statusEl.style.color = '#ef4444';
    console.error('Load data error:', e);
    console.error('Current location:', window.location.href);
    console.error('Pathname:', window.location.pathname);
  }
}
loadData();

document.getElementById('grade').addEventListener('change', e=>{
  const g = e.target.value;
  const classSel = document.getElementById('class');
  const studSel = document.getElementById('student');
  studSel.innerHTML = '';
  studSel.disabled = true;
  if(!g){ classSel.innerHTML=''; classSel.disabled=true; return; }
  const classes = Object.keys(DATA[g]||{}).sort();
  classSel.innerHTML = '<option value="">-- Chá»n lá»›p --</option>' + classes.map(c=>`<option>${c}</option>`).join('');
  classSel.disabled = false;
});

document.getElementById('class').addEventListener('change', e=>{
  const g = document.getElementById('grade').value;
  const c = e.target.value;
  const studSel = document.getElementById('student');
  if(!c){ studSel.innerHTML=''; studSel.disabled=true; return; }
  const names = (DATA[g]?.[c]||[]).map(s=>s.name);
  studSel.innerHTML = '<option value="">-- Chá»n tÃªn --</option>' + names.map(n=>`<option>${n}</option>`).join('');
  studSel.disabled = false;
});

async function sha256Hex(str){
  const enc = new TextEncoder().encode(str);
  const buf = await crypto.subtle.digest('SHA-256', enc);
  const arr = Array.from(new Uint8Array(buf));
  return arr.map(b=>b.toString(16).padStart(2,'0')).join('');
}

document.getElementById('loginBtn').addEventListener('click', async ()=>{
  statusEl.textContent = '';
  const g = document.getElementById('grade').value;
  const c = document.getElementById('class').value;
  const n = document.getElementById('student').value;
  const pw = document.getElementById('password').value.trim();
  if(!g || !c || !n || !pw){ statusEl.textContent='Vui lÃ²ng chá»n Ä‘á»§ khá»‘i, lá»›p, tÃªn vÃ  nháº­p máº­t kháº©u.'; return; }

  const list = DATA[g]?.[c] || [];
  const rec = list.find(x=>x.name===n);
  if(!rec){ statusEl.textContent='KhÃ´ng tÃ¬m tháº¥y há»c sinh.'; return; }

  const hash = await sha256Hex(pw);
  if(hash !== rec.pass_hash){ statusEl.textContent='Máº­t kháº©u khÃ´ng Ä‘Ãºng.'; return; }

  const student = { grade: g, className: c, name: n, loginAt: new Date().toISOString() };
  localStorage.setItem('student', JSON.stringify(student));

  const qp = new URLSearchParams(location.search);
  const next = qp.get('next') || 'index.html';
  location.href = next;
});
</script>

</body>
</html>
