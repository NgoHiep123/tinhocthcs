<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Test Endpoint Trá»±c Tiáº¿p</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
    button { padding: 10px 20px; font-size: 16px; margin: 10px 5px; cursor: pointer; }
    #result { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background: #f9f9f9; }
    .success { color: green; }
    .error { color: red; }
    input { padding: 8px; margin: 5px; width: 200px; }
  </style>
</head>
<body>
  <h1>ğŸ§ª Test Endpoint Google Apps Script</h1>
  
  <div>
    <h3>Nháº­p thÃ´ng tin test:</h3>
    <label>TÃªn há»c sinh: <input type="text" id="student_name" value="Nguyá»…n VÄƒn A"></label><br>
    <label>Lá»›p: <input type="text" id="class_name" value="6/14"></label><br>
    <label>MÃ£ bÃ i: <input type="text" id="quiz_id" value="K6_A1"></label><br>
    <label>Äiá»ƒm: <input type="number" id="score" value="8"></label><br>
    <label>Tá»•ng sá»‘: <input type="number" id="total" value="10"></label><br>
    <label>Thá»i gian (giÃ¢y): <input type="number" id="duration" value="120"></label><br>
  </div>
  
  <div>
    <button onclick="testWithNoCors()">Test vá»›i no-cors (nhÆ° code hiá»‡n táº¡i)</button>
    <button onclick="testWithCors()">Test vá»›i cors (xem lá»—i)</button>
    <button onclick="testDirectURL()">Má»Ÿ URL trá»±c tiáº¿p</button>
  </div>
  
  <div id="result"></div>

  <script>
    const ENDPOINT = "https://script.google.com/a/macros/asianintlschool.edu.vn/s/AKfycbxoj7jkOooCg_2ciiNIgbBjsLc2MIcGUgnIm_I43eYjPGiUOKwnloqUBCXWZOlOspWxLA/exec";

    function getData() {
      return {
        student_name: document.getElementById('student_name').value,
        class_name: document.getElementById('class_name').value,
        quiz_id: document.getElementById('quiz_id').value,
        score: document.getElementById('score').value,
        total: document.getElementById('total').value,
        duration: document.getElementById('duration').value
      };
    }

    async function testWithNoCors() {
      const resultDiv = document.getElementById('result');
      const data = getData();
      
      resultDiv.innerHTML = '<p>ğŸ”„ Äang test vá»›i no-cors mode...</p>';
      
      const url = `${ENDPOINT}?student_name=${encodeURIComponent(data.student_name)}&class_name=${encodeURIComponent(data.class_name)}&quiz_id=${data.quiz_id}&score=${data.score}&total=${data.total}&duration=${data.duration}`;
      
      console.log('Testing URL:', url);
      
      try {
        const response = await fetch(url, {
          method: 'GET',
          mode: 'no-cors',
          cache: 'no-cache'
        });
        
        resultDiv.innerHTML = `
          <p class="success">âœ… Request Ä‘Ã£ Ä‘Æ°á»£c gá»­i (no-cors mode)</p>
          <p>âš ï¸ Vá»›i no-cors, khÃ´ng thá»ƒ Ä‘á»c response</p>
          <p><strong>URL Ä‘Ã£ gá»­i:</strong></p>
          <pre style="background: white; padding: 10px; overflow-x: auto;">${url}</pre>
          <p>ğŸ“ <strong>Kiá»ƒm tra Google Sheet Ä‘á»ƒ xem cÃ³ dá»¯ liá»‡u má»›i khÃ´ng!</strong></p>
          <p>â±ï¸ Äá»£i 2-3 giÃ¢y rá»“i refresh Google Sheet</p>
        `;
        
      } catch (e) {
        resultDiv.innerHTML = `<p class="error">âŒ Lá»—i: ${e.message}</p>`;
        console.error('Error:', e);
      }
    }

    async function testWithCors() {
      const resultDiv = document.getElementById('result');
      const data = getData();
      
      resultDiv.innerHTML = '<p>ğŸ”„ Äang test vá»›i cors mode...</p>';
      
      const url = `${ENDPOINT}?student_name=${encodeURIComponent(data.student_name)}&class_name=${encodeURIComponent(data.class_name)}&quiz_id=${data.quiz_id}&score=${data.score}&total=${data.total}&duration=${data.duration}`;
      
      try {
        const response = await fetch(url, {
          method: 'GET',
          mode: 'cors'
        });
        
        const text = await response.text();
        
        resultDiv.innerHTML = `
          <p class="success">âœ… Request thÃ nh cÃ´ng!</p>
          <p><strong>Response:</strong></p>
          <pre style="background: white; padding: 10px; overflow-x: auto;">${text}</pre>
        `;
        
      } catch (e) {
        resultDiv.innerHTML = `
          <p class="error">âŒ CORS Error (Ä‘Ã¢y lÃ  bÃ¬nh thÆ°á»ng):</p>
          <pre>${e.message}</pre>
          <p>ğŸ’¡ Lá»—i CORS lÃ  bÃ¬nh thÆ°á»ng vá»›i Google Apps Script. Request váº«n cÃ³ thá»ƒ Ä‘Ã£ Ä‘Æ°á»£c gá»­i thÃ nh cÃ´ng.</p>
          <p>ğŸ“ Kiá»ƒm tra Google Sheet Ä‘á»ƒ xÃ¡c nháº­n!</p>
        `;
        console.error('CORS Error (expected):', e);
      }
    }

    function testDirectURL() {
      const data = getData();
      const url = `${ENDPOINT}?student_name=${encodeURIComponent(data.student_name)}&class_name=${encodeURIComponent(data.class_name)}&quiz_id=${data.quiz_id}&score=${data.score}&total=${data.total}&duration=${data.duration}`;
      
      window.open(url, '_blank');
      
      document.getElementById('result').innerHTML = `
        <p class="success">âœ… ÄÃ£ má»Ÿ URL trong tab má»›i</p>
        <p>ğŸ“ Xem tab má»›i Ä‘á»ƒ xem response JSON</p>
        <p>ğŸ“Š Sau Ä‘Ã³ kiá»ƒm tra Google Sheet Ä‘á»ƒ xem cÃ³ dá»¯ liá»‡u má»›i khÃ´ng</p>
      `;
    }
  </script>
</body>
</html>

