<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Test Endpoint - Ki·ªÉm Tra Cu·ªëi C√πng</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 900px; margin: 0 auto; background: #f5f5f5; }
    .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { color: #333; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
    button { padding: 12px 24px; font-size: 16px; margin: 10px 5px; cursor: pointer; border: none; border-radius: 5px; }
    .btn-primary { background: #667eea; color: white; }
    .btn-primary:hover { background: #5568d3; }
    .btn-success { background: #10b981; color: white; }
    .btn-success:hover { background: #059669; }
    #result { margin-top: 20px; padding: 20px; border: 2px solid #ddd; border-radius: 5px; background: #f9f9f9; }
    .success { color: #10b981; font-weight: bold; }
    .error { color: #ef4444; font-weight: bold; }
    .info { color: #3b82f6; }
    input { padding: 10px; margin: 5px; width: 250px; border: 1px solid #ddd; border-radius: 5px; }
    label { display: inline-block; width: 150px; font-weight: bold; }
    pre { background: #1e293b; color: #f1f5f9; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
    .checklist { background: #f0f4ff; padding: 15px; border-radius: 5px; margin: 15px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ Test Endpoint Google Apps Script - Ki·ªÉm Tra Cu·ªëi C√πng</h1>
    
    <div class="checklist">
      <h3>‚úÖ Endpoint hi·ªán t·∫°i:</h3>
      <p><strong>ID:</strong> AKfycbydBX3A2x7rES_Re5OnfdI3aybBCp-vBa7YNdJ2UUHzjGyo1wFK2mqvLLmdypJkHnBDzw</p>
      <p><strong>URL:</strong> <code>https://script.google.com/a/macros/asianintlschool.edu.vn/s/AKfycbydBX3A2x7rES_Re5OnfdI3aybBCp-vBa7YNdJ2UUHzjGyo1wFK2mqvLLmdypJkHnBDzw/exec</code></p>
    </div>
    
    <div>
      <h3>üìù Nh·∫≠p th√¥ng tin test:</h3>
      <label>T√™n h·ªçc sinh:</label>
      <input type="text" id="student_name" value="Nguy·ªÖn VƒÉn A"><br>
      
      <label>L·ªõp:</label>
      <input type="text" id="class_name" value="6/14"><br>
      
      <label>M√£ b√†i:</label>
      <input type="text" id="quiz_id" value="K6_B1"><br>
      
      <label>ƒêi·ªÉm:</label>
      <input type="number" id="score" value="8"><br>
      
      <label>T·ªïng s·ªë:</label>
      <input type="number" id="total" value="10"><br>
      
      <label>Th·ªùi gian (gi√¢y):</label>
      <input type="number" id="duration" value="120"><br>
    </div>
    
    <div style="margin-top: 20px;">
      <button class="btn-primary" onclick="testDirectURL()">1. Test URL Tr·ª±c Ti·∫øp (M·ªü Tab M·ªõi)</button>
      <button class="btn-primary" onclick="testWithFetch()">2. Test V·ªõi Fetch (No-CORS)</button>
      <button class="btn-success" onclick="checkExecutionLogs()">3. H∆∞·ªõng D·∫´n Ki·ªÉm Tra Logs</button>
    </div>
    
    <div id="result"></div>
  </div>

  <script>
    const ENDPOINT = "https://script.google.com/a/macros/asianintlschool.edu.vn/s/AKfycbydBX3A2x7rES_Re5OnfdI3aybBCp-vBa7YNdJ2UUHzjGyo1wFK2mqvLLmdypJkHnBDzw/exec";

    function getData() {
      return {
        student_name: document.getElementById('student_name').value,
        class_name: document.getElementById('class_name').value,
        quiz_id: document.getElementById('quiz_id').value,
        score: document.getElementById('score').value,
        total: document.getElementById('total').value,
        duration: document.getElementById('duration').value
      };
    }

    function testDirectURL() {
      const data = getData();
      const url = `${ENDPOINT}?student_name=${encodeURIComponent(data.student_name)}&class_name=${encodeURIComponent(data.class_name)}&quiz_id=${data.quiz_id}&score=${data.score}&total=${data.total}&duration=${data.duration}`;
      
      // M·ªü URL trong tab m·ªõi
      window.open(url, '_blank');
      
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = `
        <div class="success">
          <h3>‚úÖ ƒê√£ m·ªü URL trong tab m·ªõi</h3>
          <p>üìù <strong>B∆∞·ªõc ti·∫øp theo:</strong></p>
          <ol>
            <li>Xem tab m·ªõi - s·∫Ω hi·ªÉn th·ªã JSON response</li>
            <li>N·∫øu th·∫•y <code>{"success":true,...}</code> ‚Üí Script ho·∫°t ƒë·ªông!</li>
            <li>M·ªü Google Sheet <code>result_thcs</code> ƒë·ªÉ ki·ªÉm tra c√≥ d√≤ng m·ªõi kh√¥ng</li>
          </ol>
          <p><strong>URL ƒë√£ g·ª≠i:</strong></p>
          <pre>${url}</pre>
        </div>
      `;
    }

    async function testWithFetch() {
      const resultDiv = document.getElementById('result');
      const data = getData();
      
      resultDiv.innerHTML = '<p class="info">üîÑ ƒêang test v·ªõi fetch (no-cors mode)...</p>';
      
      const url = `${ENDPOINT}?student_name=${encodeURIComponent(data.student_name)}&class_name=${encodeURIComponent(data.class_name)}&quiz_id=${data.quiz_id}&score=${data.score}&total=${data.total}&duration=${data.duration}`;
      
      console.log('Testing URL:', url);
      console.log('Data:', data);
      
      try {
        const response = await fetch(url, {
          method: 'GET',
          mode: 'no-cors',
          cache: 'no-cache'
        });
        
        console.log('Request sent (no-cors mode)');
        
        // ƒê·ª£i m·ªôt ch√∫t
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        resultDiv.innerHTML = `
          <div class="success">
            <h3>‚úÖ Request ƒë√£ ƒë∆∞·ª£c g·ª≠i (no-cors mode)</h3>
            <p>‚ö†Ô∏è <strong>L∆∞u √Ω:</strong> V·ªõi no-cors, kh√¥ng th·ªÉ ƒë·ªçc response t·ª´ JavaScript.</p>
            <p>üìù <strong>ƒê·ªÉ ki·ªÉm tra:</strong></p>
            <ol>
              <li>M·ªü Google Sheet <code>result_thcs</code></li>
              <li>Ki·ªÉm tra c√≥ d√≤ng m·ªõi ƒë∆∞·ª£c th√™m v√†o kh√¥ng</li>
              <li>Ho·∫∑c xem Execution Logs trong Google Apps Script</li>
            </ol>
            <p><strong>URL ƒë√£ g·ª≠i:</strong></p>
            <pre>${url}</pre>
            <p><strong>D·ªØ li·ªáu:</strong></p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          </div>
        `;
        
      } catch (e) {
        resultDiv.innerHTML = `
          <div class="error">
            <h3>‚ùå L·ªói khi g·ª≠i request:</h3>
            <pre>${e.message}</pre>
            <p>üí° Ki·ªÉm tra console (F12) ƒë·ªÉ xem chi ti·∫øt l·ªói.</p>
          </div>
        `;
        console.error('Error:', e);
      }
    }

    function checkExecutionLogs() {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = `
        <div class="info">
          <h3>üìã H∆∞·ªõng D·∫´n Ki·ªÉm Tra Execution Logs</h3>
          <ol>
            <li><strong>V√†o Google Apps Script:</strong>
              <ul>
                <li>Truy c·∫≠p: <a href="https://script.google.com" target="_blank">https://script.google.com</a></li>
                <li>ƒêƒÉng nh·∫≠p b·∫±ng t√†i kho·∫£n <code>@asianintlschool.edu.vn</code></li>
              </ul>
            </li>
            <li><strong>T√¨m script:</strong>
              <ul>
                <li>T√¨m script c√≥ ID: <code>AKfycbydBX3A2x7rES_Re5OnfdI3aybBCp-vBa7YNdJ2UUHzjGyo1wFK2mqvLLmdypJkHnBDzw</code></li>
                <li>Ho·∫∑c t√¨m script li√™n quan ƒë·∫øn "result_thcs"</li>
              </ul>
            </li>
            <li><strong>Xem Execution Logs:</strong>
              <ul>
                <li>Click v√†o menu <strong>"Executions"</strong> (L·ªãch s·ª≠ th·ª±c thi)</li>
                <li>Xem c√°c execution g·∫ßn ƒë√¢y</li>
                <li>Ki·ªÉm tra:
                  <ul>
                    <li>‚úÖ <strong>Success</strong> (m√†u xanh) = Request ƒë·∫øn ƒë∆∞·ª£c v√† ch·∫°y th√†nh c√¥ng</li>
                    <li>‚ùå <strong>Failed</strong> (m√†u ƒë·ªè) = C√≥ l·ªói, click ƒë·ªÉ xem chi ti·∫øt</li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><strong>Xem Logs Chi Ti·∫øt:</strong>
              <ul>
                <li>Click v√†o m·ªôt execution ƒë·ªÉ xem chi ti·∫øt</li>
                <li>Xem ph·∫ßn <strong>"Logs"</strong> ƒë·ªÉ bi·∫øt:
                  <ul>
                    <li>Request c√≥ ƒë·∫øn ƒë∆∞·ª£c kh√¥ng?</li>
                    <li>D·ªØ li·ªáu c√≥ ƒë√∫ng kh√¥ng?</li>
                    <li>C√≥ l·ªói g√¨ kh√¥ng?</li>
                  </ul>
                </li>
              </ul>
            </li>
          </ol>
        </div>
      `;
    }
  </script>
</body>
</html>

